#!/bin/bash

CONFIGURE_SYSTEM=0
while [[ $# -gt 0 ]]; do
  key="$1"
  echo "Key: $key"
  case $key in
    --system)
      CONFIGURE_SYSTEM=1
      ;;
      *)
      ;;
  esac
  shift
done

export current_dir="$(pwd)"

if [ $CONFIGURE_SYSTEM -eq 1 ]; then
  echo "configuring system..."
  ./scripts/configure-system.sh
  cd $current_dir
fi

apt-get --no-install-recommends install -y network-manager
apt-get autoclean
apt-get autoremove -y

pip install git+https://github.com/waggle-sensor/pywaggle
pip3 install git+https://github.com/waggle-sensor/pywaggle

cp ${current_dir}/systemd/* /etc/systemd/system
systemctl enable waggle-test.service

cd ${current_dir}/device_rules/cameras
./install.sh

cd ${current_dir}/device_rules/microphones
./install.sh

echo "done"